function B(y,_){for(var m=0;m<_.length;m++){const g=_[m];if(typeof g!="string"&&!Array.isArray(g)){for(const v in g)if(v!=="default"&&!(v in y)){const S=Object.getOwnPropertyDescriptor(g,v);S&&Object.defineProperty(y,v,S.get?S:{enumerable:!0,get:()=>g[v]})}}}return Object.freeze(Object.defineProperty(y,Symbol.toStringTag,{value:"Module"}))}var k={exports:{}},M=k.exports,N;function W(){return N||(N=1,(function(y,_){(function(m,g){y.exports=g()})(M,(function(){var m=function(s,n){if(!(s instanceof n))throw new TypeError("Cannot call a class as a function")},g=(function(){function s(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(n,e,t){return e&&s(n.prototype,e),t&&s(n,t),n}})(),v=(function(){function s(n,e){var t=[],a=!0,r=!1,i=void 0;try{for(var o=n[Symbol.iterator](),u;!(a=(u=o.next()).done)&&(t.push(u.value),!(e&&t.length===e));a=!0);}catch(l){r=!0,i=l}finally{try{!a&&o.return&&o.return()}finally{if(r)throw i}}return t}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return s(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),S=function(s){if(Array.isArray(s)){for(var n=0,e=Array(s.length);n<s.length;n++)e[n]=s[n];return e}else return Array.from(s)},f={V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.2,1.1,1.0"},supportedProtocols:function(){return["v10.stomp","v11.stomp","v12.stomp"]}},F={"v10.stomp":f.V1_0,"v11.stomp":f.V1_1,"v12.stomp":f.V1_2};function U(s,n){var e=F[s];return!e&&n&&n("DEPRECATED: "+s+" is not a recognized STOMP version. In next major client version, this will close the connection."),e||f.V1_2}var h={LF:`
`,NULL:"\0"},E=function(n){return n.replace(/^\s+|\s+$/g,"")};function T(s){var n=encodeURIComponent(s),e=n.replace(/%([0-9A-F]{2})/g,function(a,r){return String.fromCharCode("0x"+r)}),t=Array.prototype.map.call(e,function(a){return a.charCodeAt(0)});return new Uint8Array(t)}function R(s){var n=String.fromCharCode.apply(String,S(s)),e=n.replace(/(.)/g,function(t,a){var r=a.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r});return decodeURIComponent(e)}function V(s){return s?encodeURIComponent(s).match(/%..|./g).length:0}function I(){var s=new Date().getTime(),n=Math.floor(Math.random()*1e3);return s+"-"+n}var C=(function(){function s(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";m(this,s),this.command=n,this.headers=e,this.body=t}return g(s,[{key:"toString",value:function(){var e=this,t=[this.command],a=this.headers["content-length"]===!1;return a&&delete this.headers["content-length"],Object.keys(this.headers).forEach(function(r){var i=e.headers[r];t.push(r+":"+i)}),this.body&&!a&&t.push("content-length:"+V(this.body)),t.push(h.LF+this.body),t.join(h.LF)}}],[{key:"unmarshallSingle",value:function(e){var t=e.search(new RegExp(h.LF+h.LF)),a=e.substring(0,t).split(h.LF),r=a.shift(),i={},o="",u=t+2,l=!0,d=!1,c=void 0;try{for(var b=a.reverse()[Symbol.iterator](),w;!(l=(w=b.next()).done);l=!0){var p=w.value,L=p.indexOf(":");i[E(p.substring(0,L))]=E(p.substring(L+1))}}catch(D){d=!0,c=D}finally{try{!l&&b.return&&b.return()}finally{if(d)throw c}}if(i["content-length"]){var P=parseInt(i["content-length"],10);o=(""+e).substring(u,u+P)}else for(var O=null,A=u;A<e.length&&(O=e.charAt(A),O!==h.NULL);A++)o+=O;return new s(r,i,o)}},{key:"unmarshall",value:function(e){var t=e.split(new RegExp(h.NULL+h.LF+"*")),a=t.slice(0,-1),r=t.slice(-1)[0],i={frames:a.map(function(o){return s.unmarshallSingle(o)}),partial:""};return r===h.LF||r.search(RegExp(h.NULL+h.LF+"*$"))!==-1?i.frames.push(s.unmarshallSingle(r)):i.partial=r,i}},{key:"marshall",value:function(e,t,a){var r=new s(e,t,a);return r.toString()+h.NULL}}]),s})(),x=(function(){function s(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};m(this,s);var t=e.binary,a=t===void 0?!1:t,r=e.heartbeat,i=r===void 0?{outgoing:1e4,incoming:1e4}:r,o=e.debug,u=o===void 0?!0:o,l=e.protocols,d=l===void 0?[]:l;this.ws=n,this.ws.binaryType="arraybuffer",this.isBinary=!!a,this.hasDebug=!!u,this.connected=!1,this.heartbeat=i||{outgoing:0,incoming:0},this.maxWebSocketFrameSize=16*1024,this.subscriptions={},this.partialData="",this.protocols=d}return g(s,[{key:"debug",value:function(){var e;this.hasDebug&&(e=console).log.apply(e,arguments)}},{key:"connect",value:function(){var e=this,t=this._parseConnect.apply(this,arguments),a=v(t,3),r=a[0],i=a[1],o=a[2];this.connectCallback=i,this.debug("Opening Web Socket..."),this.ws.onmessage=function(u){var l=u.data;if(u.data instanceof ArrayBuffer&&(l=R(new Uint8Array(u.data))),e.serverActivity=Date.now(),l===h.LF){e.debug("<<< PONG");return}e.debug("<<< "+l);var d=C.unmarshall(e.partialData+l);e.partialData=d.partial,d.frames.forEach(function(c){switch(c.command){case"CONNECTED":e.debug("connected to server "+c.headers.server),e.connected=!0,e.version=c.headers.version,e._setupHeartbeat(c.headers),i&&i(c);break;case"MESSAGE":var b=c.headers.subscription,w=e.subscriptions[b]||e.onreceive;if(w){var p=e.version===f.V1_2&&c.headers.ack||c.headers["message-id"];c.ack=e.ack.bind(e,p,b),c.nack=e.nack.bind(e,p,b),w(c)}else e.debug("Unhandled received MESSAGE: "+c);break;case"RECEIPT":e.onreceipt&&e.onreceipt(c);break;case"ERROR":o&&o(c);break;default:e.debug("Unhandled frame: "+c)}})},this.ws.onclose=function(u){e.debug("Whoops! Lost connection to "+e.ws.url+":",{event:u}),e._cleanUp(),o&&o(u)},this.ws.onopen=function(){e.debug("Web Socket Opened..."),r["accept-version"]=U(e.ws.protocol||e.protocols[0],e.debug.bind(e)),r["heart-beat"]||(r["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(",")),e._transmit("CONNECT",r)},this.ws.readyState===this.ws.OPEN&&this.ws.onopen()}},{key:"disconnect",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),e&&e()}},{key:"send",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=Object.assign({},a);r.destination=e,this._transmit("SEND",r,t)}},{key:"begin",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"tx-"+I();return this._transmit("BEGIN",{transaction:e}),{id:e,commit:this.commit.bind(this,e),abort:this.abort.bind(this,e)}}},{key:"commit",value:function(e){this._transmit("COMMIT",{transaction:e})}},{key:"abort",value:function(e){this._transmit("ABORT",{transaction:e})}},{key:"ack",value:function(e,t){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=Object.assign({},a),i=this.version===f.V1_2?"id":"message-id";r[i]=e,r.subscription=t,this._transmit("ACK",r)}},{key:"nack",value:function(e,t){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=Object.assign({},a),i=this.version===f.V1_2?"id":"message-id";r[i]=e,r.subscription=t,this._transmit("NACK",r)}},{key:"subscribe",value:function(e,t){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=Object.assign({},a);return r.id||(r.id="sub-"+I()),r.destination=e,this.subscriptions[r.id]=t,this._transmit("SUBSCRIBE",r),{id:r.id,unsubscribe:this.unsubscribe.bind(this,r.id)}}},{key:"unsubscribe",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=Object.assign({},t);delete this.subscriptions[e],a.id=e,this._transmit("UNSUBSCRIBE",a)}},{key:"_cleanUp",value:function(){this.connected=!1,clearInterval(this.pinger),clearInterval(this.ponger)}},{key:"_transmit",value:function(e,t,a){var r=C.marshall(e,t,a);this.debug(">>> "+r,{frame:{command:e,headers:t,body:a}}),this._wsSend(r)}},{key:"_wsSend",value:function(e){for(this.isBinary&&(e=T(e)),this.debug(">>> length "+e.length);;)if(e.length>this.maxWebSocketFrameSize)this.ws.send(e.slice(0,this.maxWebSocketFrameSize)),e=e.slice(this.maxWebSocketFrameSize),this.debug("remaining = "+e.length);else return this.ws.send(e)}},{key:"_setupHeartbeat",value:function(e){var t=this;if(!(this.version!==f.V1_1&&this.version!==f.V1_2)){var a=(e["heart-beat"]||"0,0").split(",").map(function(d){return parseInt(d,10)}),r=v(a,2),i=r[0],o=r[1];if(!(this.heartbeat.outgoing===0||o===0)){var u=Math.max(this.heartbeat.outgoing,o);this.debug("send PING every "+u+"ms"),this.pinger=setInterval(function(){t._wsSend(h.LF),t.debug(">>> PING")},u)}if(!(this.heartbeat.incoming===0||i===0)){var l=Math.max(this.heartbeat.incoming,i);this.debug("check PONG every "+l+"ms"),this.ponger=setInterval(function(){var d=Date.now()-t.serverActivity;d>l*2&&(t.debug("did not receive server activity for the last "+d+"ms"),t.ws.close())},l)}}}},{key:"_parseConnect",value:function(){for(var e={},t=void 0,a=void 0,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];switch(i.length){case 2:e=i[0],t=i[1];break;case 3:i[1]instanceof Function?(e=i[0],t=i[1],a=i[2]):(e.login=i[0],e.passcode=i[1],t=i[2]);break;case 4:e.login=i[0],e.passcode=i[1],t=i[2],a=i[3];break;default:e.login=i[0],e.passcode=i[1],t=i[2],a=i[3],e.host=i[4]}return[e,t,a]}}]),s})(),j={Frame:C,VERSIONS:f,client:function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=new WebSocket(n,e.protocols||f.supportedProtocols());return new x(t,e)},over:function(){for(var n=arguments.length,e=Array(n),t=0;t<n;t++)e[t]=arguments[t];return new(Function.prototype.bind.apply(x,[null].concat(e)))}};return j}))})(k)),k.exports}var $=W();const z=B({__proto__:null},[$]);export{z as w};
